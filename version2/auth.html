<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GST Billing - Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .auth-container { 
            background: #f0f2f5;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .auth-box {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        .form-switch { cursor: pointer; color: #0d6efd; }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-box">
            <h2 class="text-center mb-4">GST Billing System</h2>
            
            <!-- Login Form -->
            <div id="loginForm">
                <div class="mb-3">
                    <input type="email" class="form-control" id="loginEmail" placeholder="Email">
                </div>
                <div class="mb-3">
                    <input type="password" class="form-control" id="loginPassword" placeholder="Password">
                </div>
                <button class="btn btn-primary w-100 mb-3" onclick="login()">Login</button>
                <div class="text-center form-switch" onclick="showRegister()">
                    New user? Register here
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="d-none">
                <div class="mb-3">
                    <input type="text" class="form-control" id="regShop" placeholder="Shop Name">
                </div>
                <div class="mb-3">
                    <input type="email" class="form-control" id="regEmail" placeholder="Email">
                </div>
                <div class="mb-3">
                    <input type="password" class="form-control" id="regPassword" placeholder="Password">
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control" id="regGSTIN" placeholder="GSTIN Number">
                </div>
                <button class="btn btn-success w-100 mb-3" onclick="register()">Register</button>
                <div class="text-center form-switch" onclick="showLogin()">
                    Already registered? Login here
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script>
        class UserManager {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('gstUsers')) || [];
            }

            register(shop, email, password, gstin) {
                if(this.validateGSTIN(gstin)) {
                    this.users.push({
                        shop, email, password, gstin,
                        products: [],
                        bills: []
                    });
                    localStorage.setItem('gstUsers', JSON.stringify(this.users));
                    return true;
                }
                return false;
            }

            login(email, password) {
                return this.users.find(u => u.email === email && u.password === password);
            }

            validateGSTIN(gstin) {
                const pattern = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;
                return pattern.test(gstin);
            }
        }

        const userManager = new UserManager();

        function showRegister() {
            $('#loginForm').addClass('d-none');
            $('#registerForm').removeClass('d-none');
        }

        function showLogin() {
            $('#registerForm').addClass('d-none');
            $('#loginForm').removeClass('d-none');
        }

        function register() {
            const shop = $('#regShop').val();
            const email = $('#regEmail').val();
            const password = $('#regPassword').val();
            const gstin = $('#regGSTIN').val();

            if(userManager.register(shop, email, password, gstin)) {
                alert('Registration successful! Please login.');
                showLogin();
            } else {
                alert('Invalid GSTIN format!');
            }
        }

        function login() {
            const user = userManager.login(
                $('#loginEmail').val(),
                $('#loginPassword').val()
            );

            if(user) {
                localStorage.setItem('currentUser', JSON.stringify(user));
                window.location.href = 'billing.html';
            } else {
                alert('Invalid credentials!');
            }
        }
    </script>
</body>
</html>